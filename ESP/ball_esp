#include <WiFi.h>
#include <WiFiUdp.h>

// הגדרות רשת
const char* ssid = "AndroidAP0573";
const char* password = "iris1405";
const char* destIP = "192.168.150.67"; 
const int destPort = 4210;

WiFiUDP Udp;

// ממוצע RSSI
const int rssiSampleCount = 100;
int rssiSamples[rssiSampleCount];
int rssiIndex = 0;
bool rssiBufferFull = false;

void setup() {
  Serial.begin(115200);

  WiFi.mode(WIFI_STA);
  //IPAddress local_IP(192, 168, 150, 67);
  //IPAddress gateway(192, 168, 148, 1);
  //IPAddress subnet(255, 255, 255, 0);
  //WiFi.config(local_IP, gateway, subnet);
  WiFi.begin(ssid, password);

  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nConnected to WiFi. IP: " + WiFi.localIP().toString());

  Udp.begin(4210);
}

void loop() {
  int rssi = WiFi.RSSI();
  int lastrssi = 0;
  rssiSamples[rssiIndex++] = rssi;

  if (rssiIndex >= rssiSampleCount) {
    rssiIndex = 0;
    rssiBufferFull = true;
  }

  if (rssiBufferFull) {
    long sum = 0;
    for (int i = 0; i < rssiSampleCount; i++) {
      sum += rssiSamples[i];
    }
    int averageRSSI = sum / rssiSampleCount;

    if( averageRSSI > lastrssi + 3 || averageRSSI < lastrssi - 3){
      String message = "RSSI:" + String(averageRSSI);
      Serial.println(message);

      if (Udp.beginPacket(destIP, destPort)) {
        Udp.print(message);
        Udp.endPacket();
      } else {
        Serial.println("Failed to begin UDP packet");
      }
    }
  }

  delay(100);  // מדידה כל 10ms → שליחה כל 1 שנייה בערך
}


זה של הכדור
